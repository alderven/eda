<?phpsession_start();if(!isset($_SESSION['myusername'])) {header("location:index.php");}require_once "config.php";require_once "common.php";# 1. Check for Admin privelegesis_admin($role_id);# 2. Get ExcelId$excel_id = isset($_POST['ExcelId']) ? $_POST['ExcelId'] : '';if ($excel_id == '') {	alert("danger", "Excel файл не найден", "excel.php");}# 3. Check that anybody makes an order in Excelif (ordered_dishes_count($conn, $excel_id) == 0) {	alert("danger", "Заказчики отсутствуют", "excel.php");}# 4. Generate HTML page headerprint '	<style>			@media print {				.more {				page-break-after: always;				} 			}		</style>';# 5. Get data the from the DB$sql = "SELECT excel.Company, food.Date, food.Id, food.Name, orders.Count, users.Name as UserName, users.Surname from food		INNER JOIN orders		ON food.Id = orders.MenuItemId		INNER JOIN excel		ON excel.Id = food.ExcelId        INNER JOIN users        ON users.Id = orders.UserId		WHERE excel.Id = $excel_id        ORDER BY food.Date ASC, users.Id ASC";		$result = $conn->query($sql);$id_previous = Null;$dishes = array();$date_previous = Null;$user_surname_previous = Null;while ($row = $result->fetch_assoc()) {			$company = $row["Company"];	$date = $row["Date"];	$id = $row["Id"];	$name = $row["Name"];	$count = $row["Count"];	$user_name = $row["UserName"];	$user_surname = $row["Surname"];	if ($date_previous != $date) {		if (!is_null($date_previous)) {			print '<p class="more"></p>';		}		print '<h3>' . $company . '. ' . day_of_week($date) . '  [' . $date . ']</h3>';	}		if ($user_surname_previous != $user_surname || $date_previous != $date) {		print '<h4>' . $user_name . ' ' . $user_surname . '</h4>';	}		print ' - ' . $name . ' [' . $count . ' шт.]<br>';	$date_previous = $date;	$user_surname_previous = $user_surname;}?>