<?phpsession_start();if(!isset($_SESSION['myusername'])) {header("location:index.php");}require_once "config.php";require_once "common.php";# 1. Check for Admin privelegesis_admin($role_id);# 2. Get ExcelId$excel_id = isset($_POST['ExcelId']) ? $_POST['ExcelId'] : '';if ($excel_id == '') {	alert("danger", "Excel файл не найден", "excel.php");}# 3. Check that anybody makes an order in Excelif (ordered_dishes_count($conn, $excel_id) == 0) {	alert("danger", "Заказчики отсутствуют", "excel.php");}# 4. Get data the from the DB$days = array();$day = array();class Dish{	var  $company;	var  $date;	var  $id;	var  $name;	var  $counts = array();	var  $user_names = array();	var  $user_surnames = array();	}$sql = "SELECT excel.Company, food.Date, food.Id, food.Name, orders.Count, users.Name as UserName, users.Surname from food		INNER JOIN orders		ON food.Id = orders.MenuItemId		INNER JOIN excel		ON excel.Id = food.ExcelId        INNER JOIN users        ON users.Id = orders.UserId		WHERE excel.Id = $excel_id        ORDER BY food.Id ASC";		$result = $conn->query($sql);$id_previous = Null;$dishes = array();while ($row = $result->fetch_assoc()) {			$company = $row["Company"];	$date = $row["Date"];	$id = $row["Id"];	$name = $row["Name"];	$count = $row["Count"];	$user_name = $row["UserName"];	$user_surname = $row["Surname"];		$dish = new Dish;	$dish->company = $company;	$dish->date = $date;	$dish->id = $id;	$dish->name = $name;	array_push($dish->counts, $count);	array_push($dish->user_names, $user_name);	array_push($dish->user_surnames, $user_surname);		# If it's the same dish as previous	if ($id_previous == $id) {		# Then add dish information to the latest dish		$dish = end($dishes);		array_push($dish->counts, $count);		array_push($dish->user_names, $user_name);		array_push($dish->user_surnames, $user_surname);		array_pop($dishes);		array_push($dishes, $dish);		}	# If it's a new dish	else {		# Then add new dish		array_push($dishes, $dish);				}	$id_previous = $id;}# 5. Generate HTML pageprint '	<style>			@media print {				.more {				page-break-after: always;				} 			}		</style>';$date_previous = Null;foreach ($dishes as &$dish) {		if ($dish->date != $date_previous) {		if (!is_null($date_previous)) {			print '<p class="more"></p>';		}		print '<h1>' . $dish->company . '. ' . day_of_week($dish->date) . ' ['. $dish->date . ']</h1>';	}		print '<h3>' . $dish->name . ' [' . array_sum($dish->counts) . ' шт.]</h3>';	for ($i = 0; $i < count($dish->user_names); $i++) {		print $dish->user_names[$i] . ' ' . $dish->user_surnames[$i] . ' [' . $dish->counts[$i] . ' шт.]<br>';	}		$date_previous = $dish->date;}?>