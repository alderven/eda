<?phpsession_start();if(!isset($_SESSION['myusername'])) {header("location:index.php");}require_once "config.php";?><style>ul.leaders {    max-width: 40em;    padding: 0;    overflow-x: hidden;    list-style: none}ul.leaders li:before {    float: left;    width: 0;    white-space: nowrap;    content: ". . . . . . . . . . . . . . . . . . . . " ". . . . . . . . . . . . . . . . . . . . " ". . . . . . . . . . . . . . . . . . . . " ". . . . . . . . . . . . . . . . . . . . "}ul.leaders span:first-child {    padding-right: 0.33em;    background: white}ul.leaders span + span {    float: right;    padding-left: 0.33em;    background: white}</style><?php# 1. Get ExcelId$excel_id = isset($_POST['ExcelId']) ? $_POST['ExcelId'] : '';# 2. Get all Data.$dates = array();$dates_only = array();$full_name = array();$dishes = array();$count = array();$sql = "SELECT $table_food.Company, $table_food.Date, $table_users.Name, $table_users.Surname, $table_food.Name as FoodName, $table_food.Contain, $table_orders.Count		FROM $table_users			JOIN $table_orders				ON $table_orders.UserId = $table_users.Id			JOIN $table_food				ON $table_food.Id = $table_orders.MenuItemId		WHERE $table_food.ExcelId = " . $excel_id . " ORDER BY $table_food.Date ASC, $table_users.Name ASC";$result = $conn->query($sql);while ($row = $result->fetch_assoc()) {		$dayofweek = date('w', strtotime($row["Date"]));	if($dayofweek == 1) {		$dayofweek = 'Понедельник';	} elseif($dayofweek == 2) {		$dayofweek = 'Вторник';	} elseif($dayofweek == 3) {		$dayofweek = 'Среда';	} elseif($dayofweek == 4) {		$dayofweek = 'Четверг';	} elseif($dayofweek == 5) {		$dayofweek = 'Пятница';	} elseif($dayofweek == 6) {		$dayofweek = 'Суббота';	} elseif($dayofweek == 7) {		$dayofweek = 'Воскресенье';	} else {		$dayofweek = '';	};		$company = $row["Company"];	array_push($dates, $dayofweek . ', ' . $row["Date"]);	array_push($dates_only, $row["Date"]);	array_push($full_name, $row["Name"] . ' ' . $row["Surname"]);	array_push($dishes, $row["FoodName"] . ' ' . $row["Contain"]);	array_push($count, $row["Count"]);}# 3. Check, whether file was filled by any userif (count($full_name) == 0){	// Nobody filled this Excel file yet	print 'Заказы отсутствуют';}else {	# 4. Generate Report	print '<html>				<head>					<meta charset="utf-8">					<title>Распечатка для Людмилы. ' . $company . '. ' . $dates_only[0] . '_' . $dates_only[count($dates_only)-1] . '</title>					<style type="text/css">					   @media print{					   .newpage{page-break-before: always;}					   } 					</style>				</head>				<body onload="startDownload();">';					$previous_date = '';	$previous_person = '';	$previous_dish = '';	for ($i = 0; $i < count($dates); $i++) {				# 5. Generate new Date Title		if ($previous_date === '')		{			print '<h2 align="center">' . $company . '. ' . $dates[$i] . '</h2>';		}		elseif ($previous_date !== $dates[$i])		{			print '<div class="newpage"><h2 align="center">' . $company . '. ' . $dates[$i] . '</h2></div>';		}				if ($previous_person !== $full_name[$i] or $previous_date !== $dates[$i])		{			print '<br><strong>' . $full_name[$i] . '</strong>';		}		print '<ul class=leaders><li><span>' . $dishes[$i] . '</span><span>' . $count[$i] . '</span></ul>';				/*		if ($previous_dish !== $dishes[$i])		{			print '<ul class=leaders><li><span>' . $dishes[$i] . '</span><span>' . $count[$i] . '</span></ul>';		}		*/						$previous_date = $dates[$i];		$previous_person = $full_name[$i];		$previous_dish = $dishes[$i];	}		print '</body>	</html>';}?>